<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xiaoyu.mapper.yujiTaskOrdersMapper">

    <resultMap id="taskOrderListMap" type="com.xiaoyu.vo.task.ListTaskOrdersVO">
        <id property="id" column="id"/>
        <result property="taskId" column="taskId"/>
        <result property="taskTitle" column="taskTitle"/>
        <result property="status" column="status"/>
        <result property="createdAt" column="createdAt"/>
        <result property="updatedAt" column="updatedAt"/>

        <association property="publisher" javaType="com.xiaoyu.vo.task.ListTaskOrdersVO$User">
            <id property="id" column="publishId"/>
            <result property="nickname" column="publisherNickname"/>
            <result property="avatarUrl" column="publisherAvatarUrl"/>
        </association>
        <association property="receiver" javaType="com.xiaoyu.vo.task.ListTaskOrdersVO$User">
            <id property="id" column="receiverId"/>
            <result property="nickname" column="receiverNickname"/>
            <result property="avatarUrl" column="receiverAvatarUrl"/>
        </association>

    </resultMap>


    <select id="getListOrders" resultMap="taskOrderListMap">
        select `to`.id as id , `to`.task_id as taskId,
               t.title as taskTitle, u.id as publishId,
               u.nickname as publisherNickname, u.avatar_url as publisherAvatarUrl,
               u1.id as receiverId, u1.nickname as receiverNickname,
               u1.avatar_url as receiverAvatarUrl,
               `to`.status as status, `to`.created_at as createdAt,
               `to`.updated_at as updatedAt
        from task_orders `to`
        left join tasks t on t.id = `to`.task_id
        left join users u on u.id = t.publisher_id
        left join users u1 on u1.id = `to`.receiver_id
        <where>
            <if test="roleType != null and roleType = 'PUBLISHER'">and t.publisher_id = #{currentId}</if>
            <if test="roleType != null and roleType = 'RECEIVER'">and `to`.receiver_id = #{currentId}</if>
            <if test="status != null">and `to`.status = #{status}</if>
        </where>
    </select>
</mapper>
